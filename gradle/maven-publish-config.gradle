// Based on this article: https://getstream.io/blog/publishing-libraries-to-mavencentral-2021/

File secretPropsFile = project.rootProject.file('local.properties')
if (secretPropsFile.exists()) {
    Properties lp = new Properties()
    new FileInputStream(secretPropsFile).withCloseable { is ->
        lp.load(is)
    }
    if (lp.containsKey('SIGNING_CONFIG')) {
        File signingConfigFile = file(lp.getProperty('SIGNING_CONFIG'))
        if (signingConfigFile.exists()) {
            Properties sc = new Properties()
            new FileInputStream(signingConfigFile).withCloseable { is ->
                sc.load(is)
            }
            sc.each { name, value ->
                ext[name] = value
            }
        } else {
            getFromEnv()
        }
    } else {
        getFromEnv()
    }
} else {
    getFromEnv()
}

def getFromEnv() {
    ext["signingKey"] = System.getenv('SIGNING_KEY')
    ext["signingPassword"] = System.getenv('SIGNING_PASSWORD')
    ext["ossrhUsername"] = System.getenv('OSSRH_USERNAME')
    ext["ossrhPassword"] = System.getenv('OSSRH_PASSWORD')
    ext["sonatypeStagingProfileId"] = System.getenv('SONATYPE_STAGING_PROFILE_ID')
}
